<!-- page url: {{page.url}} -->

{% if page.url == "/index.html" or page.url == "/" %}
<canvas></canvas>
<div class="canvas__text">
    <h1>
        Clean and Clear Websites
    </h1>
    <h2>
        For a world suffering from hurry sickness
    </h2>
</div>
{% endif %}

<header>
    {% if page.url == "/index.html" or page.url == "/" %}
    <nav role="navigation" class="canvas">
    {% else %}
    <nav role="navigation">
    {% endif %}
        <div id="top-strip"></div>
        <div class="container">

            <!-- mobile -->
            <!-- <div class="nav-mobile visible-xs">
                <div id="logo__container">
                    <a href="/">
                        <img src="/images/logo.png" />
                        <span class="company_name">Cocept</span>
                    </a>
                </div>
            </div> -->

            <!-- mobile test -->
            <div class="row nav-mobile visible-xs">
                <div class="col-sm-12" id="logo__container">
                    <div id="hamburger">
                        <a><span></span></a>
                    </div>
                    <div>
                        <a href="/">
                            <img src="/images/logo.png" />
                        </a>
                    </div>
                    <div>
                        <a href="/">
                            <span class="company_name">Cocept</span>
                        </a>
                    </div>
                </div>
            </div>
        </div>

            <!-- desktop -->
            <div class="row nav-desktop hidden-xs">
                <div class="col-sm-5 right" id="links">
                    <ul>
                        <li>
                            <a href="/portfolio/">Work</a>
                        </li>
                        <li>
                            <a href="/training/">Training</a>
                        </li>
                    </ul>
                </div>
                <div class="col-sm-2" id="logo__container">
                    <div>
                        <a href="/">
                            <img src="/images/logo.png" />
                        </a>
                    </div>
                    <div>
                        <a href="/">
                            <span class="company_name">Cocept</span>
                        </a>
                    </div>
                </div>
                <div class="col-sm-5" id="links">
                    <ul>
                        <li class="dropdown">
                            <a href="#" data-toggle="dropdown" class="dropdown-toggle">
                                Articles <b class="caret"></b>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a href="/design">Design</a></li>
                                <li><a href="/development">Development</a></li>
                            </ul>
                        </li>
                        <li>
                            <a href="/contact/">Contact</a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

</header>

<style type="text/css">
    canvas {
        width: 100%;
        height: 440px;
        background-color: #333;
    }

    .canvas__text {
        position: absolute;
        top: 150px;
        left: 0px;
        width: 100%;
        text-align: center;
        color: white;
    }

    nav {
        margin-top: -8px;
    }

    div#nav_ghost {
        background-color: #eaeaea;
        height: 170px;
        margin-top: -8px;
    }

    div#nav_ghost.hidden {
        display: none;
    }

</style>

<script type="text/javascript" src="https://cdn.jsdelivr.net/json-minify/0.1/minify.json.min.js"></script>

<script type="text/javascript">
    
    // settings
    var target_element_selector = '.nav-desktop #logo__container img'; // the element the mouse must be on to reveal the image
    var circle_radius = 5;
    var image_width = 645;
    var image_height = 400;
    var min_mouse_distance = 250;
    var target_distance_leniency = 40; // mouse can be this far away from target element and still be considered "on it"
    var start_position_off_canvas_limit_x = 50; // how far the circle start positions can be off the canvas
    var start_position_off_canvas_limit_y = 50; 
    var circle_movement_speed = 0.05; // the speed modifier for circles. 0.05 is a smooth and medium speed value
    var noise_x = 5; // amount of random movement on the x axis to add when circle is in the end_position
    var noise_y = 5;

    function randomNumberBetween(min, max){
        return Math.floor(Math.random() * max) + min;
    }

    // represents x and y coordinates
    var Coordinates = function(x,y){
        this.x = x;
        this.y = y;

        this.copy = function(){
            return new Coordinates(this.x, this.y);
        }

        this.minus = function(coordinates){
            var this_new = this.copy();
            this_new.x -= coordinates.x;
            this_new.y -= coordinates.y;
            return this_new;
        }

        this.plus = function(coordinates) {
            var this_new = this.copy();
            this_new.x += coordinates.x;
            this_new.y += coordinates.y;
            return this_new;   
        }

        this.times = function(amount){
            var this_new = this.copy();
            this_new.x *= amount;
            this_new.y *= amount;
            return this_new;      
        }

        this.equals = function(coordinates){
            if (coordinates.x == this.x && coordinates.y == this.y)
                return true;
            else
                return false;
        }

        this.toString = function()
        {
            return "x: " + this.x + ", y: " + this.y;
        }

    }

    var Circle = function(end_position, start_position, radius){
        // if start position not defined, set it to random value
        if (typeof start_position === 'undefined') { 
            rand_x = randomNumberBetween(0 - start_position_off_canvas_limit_x, canvas_width + (start_position_off_canvas_limit_x * 2));
            rand_y = randomNumberBetween(0 - start_position_off_canvas_limit_y, canvas_height + (start_position_off_canvas_limit_y * 2));
            start_position = new Coordinates(rand_x, rand_y);
        }
        if (typeof radius === 'undefined') { 
            radius = circle_radius;
        }

        // make end position relative to image dimensions
        end_position.x = (canvas_width / 2) - (image_width / 2) + end_position.x;
        end_position.y = (canvas_height / 2) - (image_height / 2) + end_position.y;

        // remember all params
        this.start_position = start_position;
        this.end_position = end_position;
        this.radius = radius;

        // set current position
        this.position = new Coordinates(start_position.x, start_position.y);

        // lerp function - move gradually frame by frame
        this.lerp = function(target_position){
            this.position.x += (target_position.x - this.position.x) * circle_movement_speed;
            this.position.y += (target_position.y - this.position.y) * circle_movement_speed;
        }

        // update this.position according to how far towards the end position the circle should be
        this.update_position = function(distance_as_percentage){
            if(distance_as_percentage > 100 || distance_as_percentage < 0)
                throw "distance_as_percentage must be between 0 and 100";
            distance_as_percentage /= 100;
            this.lerp(this.start_position.minus(this.end_position).times(distance_as_percentage).plus(this.end_position));
            return this;
        }

        // draw the circle on the canvas
        this.draw = function(last_circle){
            draw_position = this.position;

            // if position is end, add some noise
            if (distance_as_percentage == 0){
                var draw_position_noise_x = randomNumberBetween(0 - noise_x, noise_x)
                var draw_position_noise_y = randomNumberBetween(0 - noise_y, noise_y);
                draw_position = new Coordinates(draw_position_noise_x + this.position.x, 
                                                draw_position_noise_y + this.position.y);
            }

            // draw the circle
            draw_circle(draw_position, this.radius);

            // draw connecting lines
            if(last_circle != null){
                draw_line(last_circle.position, draw_position);
            }
        }
    };

    // canvas and canvas properties
    var ctx;
    var canvas_width;
    var canvas_height;

    // variables used during calculations
    var mouse_position = new Coordinates(0, 0);
    var distance;
    var distance_as_percentage;

    // populate circles from circles.json
    var circle_json;
    var circle_groups = [];

    function parseCircleJsonIntoCircles(number_of_duplicates){
        // number_of_duplicates default
        if(typeof(number_of_duplicates) === 'undefined')
            number_of_duplicates = 3

        // clear existing circles
        circle_groups = [];

        // circles in the same array will be connected by a line
        for(var i = 0; i < number_of_duplicates; i++) {
            $.each(circle_json, function(index, coordinate_group){
                var group = [];
                $.each(coordinate_group, function(index, coordinates){
                    group.push(new Circle(new Coordinates(coordinates.x, coordinates.y)));
                });
                circle_groups.push(group);
            });
        }
    }

    $(document).ready(function(){
        $.ajax({
            url: '/circles.json', 
            dataType: 'text',
            success: function(data){
                // minify json to remove comments before parsing
                circle_json = JSON.parse(JSON.minify(data));
                parseCircleJsonIntoCircles();
            },
            fail: function(){
                console.log('There was a problem loading the circles');
            }
        });
    });

    // on window resize, reparse circles
    $(window).resize(function() {
        canvas_width = $("canvas").width();
        parseCircleJsonIntoCircles();
    });

    // save mouse position
    $(document).mousemove(function(e) {  
        mouse_position = new Coordinates(e.pageX, e.pageY);
    });

    function calculateDistanceFromMouseToElement(element) {
        return Math.floor(
            Math.sqrt(
                Math.pow(
                    mouse_position.x - (element.offset().left+(element.width()/2)), 2
                ) + Math.pow(
                    mouse_position.y - (element.offset().top+(element.height()/2)), 2)
                )
            );
    }

    function init() {
        ctx = $('canvas')[0].getContext("2d");
        canvas_width = $("canvas").width();
        canvas_height = $("canvas").height();
        return setInterval(draw, 10);
    }

    function draw_circle(position, radius) {
        ctx.beginPath();
        ctx.arc(position.x, position.y, radius, 0, Math.PI*2, true);
        ctx.fillStyle = "black";
        ctx.fill();
        ctx.closePath();
    }

    function draw_line(start_position, end_position){
        ctx.beginPath();
        ctx.moveTo(start_position.x, start_position.y);
        ctx.lineTo(end_position.x, end_position.y);
        ctx.stroke();
    }

    function clear() {
        ctx.clearRect(0, 0, canvas_width, canvas_height);
    }

    function draw() {
        // set canvas dimensions
        ctx.canvas.width  = window.innerWidth;
        ctx.canvas.height = 440;
        clear();

        // calculate mouse distance to element
        distance = calculateDistanceFromMouseToElement($(target_element_selector));
        distance_as_percentage = Math.max((distance / min_mouse_distance * 100) - target_distance_leniency, 0);

        // update circle positions
        $.each(circle_groups, function(index, circle_group){
            $.each(circle_group, function(index, circle){
                if(distance_as_percentage > 100){
                    distance_as_percentage = 100;
                }
                circle.update_position(distance_as_percentage);
            });
        });

        // redraw circles
        $.each(circle_groups, function(index, circle_group){
            var last_circle = null;

            $.each(circle_group, function(index, circle){
                // draw circle
                circle.draw(last_circle);
                last_circle = circle;
            });
        });
    }

    init();
</script>
